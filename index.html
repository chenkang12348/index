<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="" />
  </head>
  <body>
    <style>
      *,
      html,
      body {
        margin: 0;
        padding: 0;
      }
      #app {
        width: 100%;
        height: 100vh;
        /* text-align: center; */
      }
      .flex-style {
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .p-style {
        font-size: 24px;
        font-weight: bold;
        margin: 20px;
      }
      .input-style {
        font-size: 24px;
        padding-left: 10px;
        outline: none;
        border: none;
        border-bottom: 1px solid #ccc;
      }
      .btn {
        width: 100px;
        height: 32px;
        font-size: 18px;
      }
    </style>
    <div id="app" class="flex-style">
      <!--  -->
      <header></header>
      <main class="flex-style">
        <p class="p-style">
          位数:
          <input
            type="number"
            class="input-style inputIndex"
            id="inputIndex"
            placeholder="默认10位"
          />
        </p>
        <p class="p-style">
          随机码:
          <input type="text" class="input-style" id="inputValue" readonly />
        </p>

        <button class="btn" id="myBtn">生成</button>
      </main>
      <footer></footer>
    </div>
    <script language="JavaScript">
      (function () {
        console.log(new Date().getTime());
        const _charStr =
          'abacdefghjklmnopqrstuvwxyzABCDEFGHJKLMNOPQRSTUVWXYZ0123456789';
        document.getElementById('myBtn').onclick = function () {
          btn();
        };
        let index;
        document.getElementById('inputIndex').oninput = function (value) {
          index = value.target.value * 1;
        };
        let inputValue = document.getElementById('inputValue');
        function btn() {
          let str = getRandomString(index);
          inputValue.value = str;
          handleClick(str);
        }
        function handleClick(str) {
          const input = document.createElement('input');
          input.value = str;
          document.body.appendChild(input);
          input.select();
          document.execCommand('Copy');
          document.body.removeChild(input);

          setTimeout(() => {
            alert(`已复制到粘贴板${str}`);
          }, 100);
        }

        function RandomIndex(min, max, i) {
          let index = Math.floor(Math.random() * (max - min + 1) + min),
            numStart = _charStr.length - 10;
          //如果字符串第一位是数字，则递归重新获取
          if (i == 0 && index >= numStart) {
            index = RandomIndex(min, max, i);
          }
          //返回最终索引值
          return index;
        }
        function getRandomString(len) {
          let min = 0,
            max = _charStr.length - 1,
            _str = '';
          //判断是否指定长度，否则默认长度为10
          len = len || 10;
          //循环生成字符串
          for (var i = 0, index; i < len; i++) {
            index = RandomIndex(min, max, i);
            _str += _charStr[index];
          }
          return _str;
        }
      })();
    </script>
  </body>
</html>
